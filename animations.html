<!doctype html>
<html>
	<head>
		<script type="text/javascript" src="C2D.js"></script>
		<script type="text/javascript" src="sprite.js"></script>
		<script type="text/javascript" src="utility.js"></script>
		<script type="text/javascript">
			var times = 5, speed = 50, animations = {
				"up" : {
					sequence : [0]
				},
				"animation-up" : {
					sequence : H(1, 9, times)
				},
				"left" : {
					sequence : [9]
				},
				"animation-left" : {
					sequence : H(10, 18, times)
				},
				"down" : {
					sequence : [18]
				},
				"animation-down" :  {
					sequence : H(19, 27, times)
				},
				"right" : {
					sequence : [27]
				},
				"animation-right" :  {
					sequence : H(28, 36, times)
				}
			}, keys =  {
                up : stdKey("dy", "up", -1),
                down : stdKey("dy", "down", 1),
                left : stdKey("dx", "left", -1),
                right : stdKey("dx", "right", 1)
            };
            function stdKey(x_or_y, direction, sign) {
               return {
                    pressed : function() {
                        if(!this.isMoving()) {
                            this[x_or_y] = sign * speed;
                            for(var i = 0; i < this.sprites[0].sprites.length; i++) {
                                this.sprites[0].sprites[i].animate("animation-" + direction);
                            }
                        }
                    },
                    up : function() {
                        if(this[x_or_y] * sign > 0) {
                            this[x_or_y] = 0;
                            for(var i = 0; i < this.sprites[0].sprites.length; i++) {
                                this.sprites[0].sprites[i].animate(direction);
                            }  
                        }
                    }
                };
            }
			function addSprite(sprite, image) {
				sprite.add(new Sprite({
					image : "images/character/walkcycle/" + image + ".png",
					columns : 9,
					rows : 4,
					animations : animations
				}, function() {
                    this.animate("down");
                }));
			}
			var walkcycle = {
					width : 64,
					height : 64,
					init : function() {
						addSprite(this, "BODY_male");
						addSprite(this, "HEAD_plate_armor_helmet");
						addSprite(this, "LEGS_plate_armor_pants");
						addSprite(this, "TORSO_plate_armor_torso");
						addSprite(this, "TORSO_plate_armor_arms_shoulders");
						addSprite(this, "FEET_plate_armor_shoes");
						addSprite(this, "HANDS_plate_armor_gloves");
						addSprite(this, "WEAPON_shield_cutout_body");
					}
			};
			var c2d = new C2D("screen", function() {
				c2d.setScreen("screen", new Sprite({
        			width : 64,
    				height : 64,
                    movement : "d",
                    keys : keys
    			}, function() {
    				this.add(new Sprite(walkcycle));
    			}));
				c2d.start();
			});
		</script>
	</head>
	<body>
		<canvas id="screen">Canvas not supported.</canvas>
	</body>
</html>